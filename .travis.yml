---
language: python

env:
  - image_id=centos-6-x64 ansible_version=2.4.1.0
  - image_id=centos-6-x64 ansible_version=2.0.2.0
  - image_id=centos-6-x64 ansible_version=1.9.6
  - image_id=centos-7-x64 ansible_version=2.4.1.0
  - image_id=centos-7-x64 ansible_version=2.0.2.0
  - image_id=centos-7-x64 ansible_version=1.9.6
  - image_id=debian-8-x64 ansible_version=2.4.1.0
  - image_id=debian-9-x64 ansible_version=2.4.1.0
  - image_id=fedora-23-x64 ansible_version=2.4.1.0 ansible_version=2.4.1.0
  - image_id=fedora-23-x64 ansible_version=2.4.1.0 ansible_version=2.0.2.0
  - image_id=fedora-23-x64 ansible_version=2.4.1.0 ansible_version=1.9.6
  - image_id=fedora-24-x64 ansible_version=2.4.1.0 ansible_version=2.4.1.0
  - image_id=fedora-24-x64 ansible_version=2.4.1.0 ansible_version=2.0.2.0
  - image_id=fedora-24-x64 ansible_version=2.4.1.0 ansible_version=1.9.6
  - image_id=fedora-25-x64 ansible_version=2.4.1.0 ansible_version=2.4.1.0
  - image_id=fedora-25-x64 ansible_version=2.4.1.0 ansible_version=2.0.2.0
  - image_id=fedora-25-x64 ansible_version=2.4.1.0 ansible_version=1.9.6
  - image_id=fedora-26-x64 ansible_version=2.4.1.0 ansible_version=2.4.1.0
  - image_id=fedora-26-x64 ansible_version=2.4.1.0 ansible_version=2.0.2.0
  - image_id=fedora-26-x64 ansible_version=2.4.1.0 ansible_version=1.9.6
  - image_id=ubuntu-14-04-x64 ansible_version=2.4.1.0
  - image_id=ubuntu-16-04-x64 ansible_version=2.4.1.0

install:
  - pip install "ansible==${ansible_version}"
  - pip install "dopy<=0.3.6"
  - ansible-playbook --inventory tests/inventory --extra-vars="image_id=${image_id} api_token=${api_token}" provision_machine.yml --connection=local

script:
  - ansible-playbook --inventory tests/inventory tests/test.yml

after_script:
  - ansible-playbook --inventory tests/inventory --extra-vars="image_id=${image_id} api_token=${api_token}" decommission_machine.yml --connection=local

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
