---
language: python

stages:
  - provision
  - test
  - decommission

env:
  - image_id: centos-6-x64
  - image_id: centos-7-x64
  - image_id: debian-7-x64
  - image_id: debian-8-x64
  - image_id: debian-9-x64
  - image_id: fedora-23-x64
  - image_id: fedora-24-x64
  - image_id: fedora-25-x64
  - image_id: fedora-26-x64
  - image_id: ubuntu-14-04-x64
  - image_id: ubuntu-16-04-x64

jobs:
  include:
    - stage: provision
      script:
        - ansible-playbook --inventory tests/inventory --extra-vars="image_id=${image_id} api_key=${api_key}" provision_machine.yml

    - stage: test
      script:
        - ansible-playbook --inventory tests/inventory tests/test.yml

    - stage: decommission
      script:
        - ansible-playbook --inventory tests/inventory --extra-vars="image_id=${image_id} api_key=${api_key}" decommission_machine.yml

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
