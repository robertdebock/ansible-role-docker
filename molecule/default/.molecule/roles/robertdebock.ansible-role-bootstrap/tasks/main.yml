---
# tasks file for ansible-role-bootstrap
- name: register release
  raw: cat /etc/*-release
  register: release
  changed_when: false

- name: install python on alpine
  raw: apk update ; apk add python
  when:
    - "'alpine' in release.stdout"
  register: pythonalpine
  changed_when:
    - "'Installing python' in pythonalpine.stdout"

- name: install python2 on centos
  raw: yum -y install python2
  when:
    - "'CentOS' in release.stdout"
  register: python2centos
  changed_when:
    - "'Nothing' not in python2centos.stdout"

- name: install python on debian
  raw: apt-get update ; apt-get -y install python
  when:
    - "'Debian' in release.stdout"
  register: pythondebian
  changed_when:
    - "' 0 newly installed' not in pythondebian.stdout"

- name: install python2 on fedora
  raw: yum -y install python2
  when:
    - "'Fedora' in release.stdout"
  register: python2fedora
  changed_when:
    - "'Nothing' not in python2fedora.stdout"

- name: install python2 on red hat
  raw: yum -y install python2
  when:
    - "'Red Hat' in release.stdout"
  register: python2redhat
  changed_when:
    - "'Nothing' not in python2redhat.stdout"

- name: install python on ubuntu
  raw: apt-get update ; apt-get -y install python
  when:
    - "'Ubuntu' in release.stdout"
  register: pythonubuntu
  changed_when:
    - "' 0 newly installed' not in pythonubuntu.stdout"

- name: gather facts
  setup:

- name: include distribution specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}-{{ ansible_distribution_major_version}}.yml"
    - "{{ ansible_distribution }}.yml"
    - "default.yml"

- name: install required packages
  package:
    name: "{{ item }}"
    state: present
  with_items: "{{ packages }}"
